{% extends "base.html" %}

{% block body %}
<h3>{% if msg.hasFile %}Upload{% else %} Comment {% endif %} By <a href="/user/{{msg.user}}/">{{msg.user}}</a></h3>

{% if current_userisadmin %}<p><a href="/meta/{{msg.key}}/edit"><img src="/static/pencil.png"> Edit</a></p> {% endif %}

<div class="message">
<p class="meta">  <small>Posted on {{msg.date|date:"D F dS Y H:i"}} Z</small>
		<br/>
		{% for a in msg.agencies %}
			<a href="{{a.link}}">{{a.name}}</a>
		{% endfor %} 
	</p>
<div class="content">{{msg.content|markdown}}</div>
{% if msg.hasFile %}
<p><a href="{{msg|gtfsurl}}"><img src="/static/package.png" valign="bottom" hspace="3">{{msg.filename}}</a> {% if msg.size %}<span class="filesize">{{msg.size|filesizeformat}}</span>{% endif %} <br/>
MD5: {{msg.md5sum}}<br/>
	</p>
{{msg.validation_results}}
{% endif %}
</div>
{% if msg.max_lat %}
<div id="map" style="width:600px; height:400px"></div>

<script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=false">
</script>
<script type="text/javascript">
    var bounds = {
      maxLat: {{ msg.max_lat }},
      maxLng: {{ msg.max_lng }},
      minLat: {{ msg.min_lat }},
      minLng: {{ msg.min_lng }}
    };
    function initialize() {
        var centerLat = (bounds.maxLat + bounds.minLat) / 2;
        var centerLng = (bounds.maxLng + bounds.minLng) / 2;

        var latlng = new google.maps.LatLng(centerLat, centerLng);
        var mapOptions = {
          zoom: 10,
          center: latlng,
          mapTypeId: google.maps.MapTypeId.ROADMAP
        };
        var map = new google.maps.Map(document.getElementById("map"), mapOptions);
        rectangle = new google.maps.Rectangle();
        
        var latlngBounds = new google.maps.LatLngBounds(new google.maps.LatLng(bounds.minLat, bounds.minLng),
                new google.maps.LatLng(bounds.maxLat, bounds.maxLng));
        var rectOptions = {
          strokeColor: "#666666",
          strokeOpacity: 0.8,
          strokeWeight: 2,
          fillColor: "transparent",
          fillOpacity: 0.35,
          map: map,
          bounds: latlngBounds
        };
        rectangle.setOptions(rectOptions);
      });
    }
    window.onload = initialize;
</script>
{% endif %}

{% endblock body %}